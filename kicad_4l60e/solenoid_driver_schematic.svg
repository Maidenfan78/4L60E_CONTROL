<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -20 1400 1210" font-family="Consolas, monospace" font-size="12">
  <title>4L60-E Solenoid Driver Stage Schematic</title>

  <defs>
    <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#333"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1400" height="1190" fill="#FAFAFA" rx="8"/>

  <!-- Title -->
  <text x="700" y="30" text-anchor="middle" font-size="18" font-weight="bold" fill="#222">4L60-E Solenoid Driver Stage — 5 Channels</text>
  <text x="700" y="48" text-anchor="middle" font-size="11" fill="#666">Low-Side MOSFET Drivers with Flyback Protection (Teensy 4.1 → SSA/SSB/TCC/TCC PWM/EPC)</text>

  <!-- ============================================================ -->
  <!-- CHANNEL 1: SSA (Shift Solenoid A) -->
  <!-- ============================================================ -->

  <text x="60" y="85" font-size="14" font-weight="bold" fill="#1a5276">Channel 1: SSA (Shift Solenoid A)</text>

  <!-- Teensy Pin 2 input -->
  <rect x="30" y="110" width="100" height="30" fill="#27ae60" rx="4"/>
  <text x="80" y="130" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Teensy Pin 2</text>
  <text x="80" y="152" text-anchor="middle" font-size="9" fill="#888">3.3V logic</text>

  <!-- Wire to gate resistor -->
  <line x1="130" y1="125" x2="170" y2="125" stroke="#333" stroke-width="2"/>

  <!-- Gate resistor R1 -->
  <rect x="170" y="118" width="50" height="14" fill="none" stroke="#333" stroke-width="1.5" rx="2"/>
  <text x="195" y="128" text-anchor="middle" font-size="9" fill="#333" font-weight="bold">100R</text>
  <text x="195" y="110" text-anchor="middle" font-size="9" fill="#555">R1</text>

  <!-- Wire to gate junction -->
  <line x1="220" y1="125" x2="260" y2="125" stroke="#333" stroke-width="2"/>
  <circle cx="260" cy="125" r="3" fill="#333"/>

  <!-- Gate pulldown R2 to GND -->
  <line x1="260" y1="125" x2="260" y2="160" stroke="#333" stroke-width="1.5"/>
  <rect x="250" y="160" width="20" height="40" fill="none" stroke="#333" stroke-width="1.5" rx="2"/>
  <text x="275" y="180" font-size="9" fill="#555">R2</text>
  <text x="275" y="192" font-size="9" fill="#555">100k</text>
  <line x1="260" y1="200" x2="260" y2="220" stroke="#333" stroke-width="1.5"/>
  <!-- GND symbol -->
  <line x1="248" y1="220" x2="272" y2="220" stroke="#333" stroke-width="2"/>
  <line x1="252" y1="225" x2="268" y2="225" stroke="#333" stroke-width="1.5"/>
  <line x1="256" y1="230" x2="264" y2="230" stroke="#333" stroke-width="1"/>

  <!-- MOSFET Q1 (STP36NF06L) -->
  <line x1="260" y1="125" x2="310" y2="125" stroke="#333" stroke-width="2"/>
  <line x1="320" y1="100" x2="320" y2="170" stroke="#333" stroke-width="2"/>
  <line x1="310" y1="125" x2="317" y2="125" stroke="#333" stroke-width="2"/>
  <line x1="320" y1="100" x2="345" y2="100" stroke="#333" stroke-width="2.5"/>
  <text x="350" y="105" font-size="9" fill="#333" font-weight="bold">D</text>
  <line x1="320" y1="170" x2="345" y2="170" stroke="#333" stroke-width="2.5"/>
  <text x="350" y="175" font-size="9" fill="#333" font-weight="bold">S</text>
  <polygon points="320,125 330,120 330,130" fill="#333"/>
  <text x="330" y="145" font-size="10" fill="#333" font-weight="bold">Q1</text>
  <text x="365" y="135" font-size="9" fill="#555">STP36NF06L</text>
  <text x="365" y="148" font-size="9" fill="#888">60V / 30A</text>
  <text x="365" y="161" font-size="9" fill="#888">40mR RDS(on)</text>

  <!-- Drain connection up to solenoid -->
  <line x1="345" y1="100" x2="345" y2="60" stroke="#333" stroke-width="2.5"/>

  <!-- Solenoid symbol (coil) -->
  <circle cx="345" cy="45" r="8" fill="none" stroke="#333" stroke-width="1.5"/>
  <circle cx="345" cy="30" r="8" fill="none" stroke="#333" stroke-width="1.5"/>
  <text x="360" y="40" font-size="10" fill="#333" font-weight="bold">SSA Solenoid</text>
  <text x="360" y="53" font-size="9" fill="#888">~0.5-0.8A @ 12V</text>

  <!-- Solenoid to +12V -->
  <line x1="345" y1="22" x2="345" y2="0" stroke="#c0392b" stroke-width="2.5"/>
  <text x="320" y="-5" font-size="10" fill="#c0392b" font-weight="bold">+12V_SOL</text>

  <!-- TVS flyback -->
  <circle cx="290" cy="80" r="3" fill="#333"/>
  <line x1="290" y1="80" x2="290" y2="55" stroke="#333" stroke-width="1.5"/>
  <polygon points="278,55 302,55 290,30" fill="none" stroke="#333" stroke-width="1.5"/>
  <line x1="278" y1="30" x2="302" y2="30" stroke="#333" stroke-width="2"/>
  <line x1="278" y1="30" x2="275" y2="35" stroke="#333" stroke-width="1.5"/>
  <line x1="302" y1="30" x2="305" y2="35" stroke="#333" stroke-width="1.5"/>
  <line x1="290" y1="30" x2="290" y2="10" stroke="#333" stroke-width="1.5"/>
  <line x1="290" y1="10" x2="345" y2="10" stroke="#333" stroke-width="1.5"/>
  <circle cx="345" cy="10" r="3" fill="#333"/>
  <text x="250" y="48" font-size="9" fill="#555" font-weight="bold">TVS1</text>
  <text x="210" y="60" font-size="9" fill="#888">5KP36CA</text>
  <text x="210" y="72" font-size="9" fill="#888">Fast decay</text>

  <line x1="290" y1="80" x2="345" y2="80" stroke="#333" stroke-width="1.5"/>
  <circle cx="345" cy="80" r="3" fill="#333"/>

  <!-- Source to GND -->
  <line x1="345" y1="170" x2="345" y2="220" stroke="#333" stroke-width="2"/>
  <line x1="333" y1="220" x2="357" y2="220" stroke="#333" stroke-width="2.5"/>
  <line x1="337" y1="225" x2="353" y2="225" stroke="#333" stroke-width="2"/>
  <line x1="341" y1="230" x2="349" y2="230" stroke="#333" stroke-width="1.5"/>
  <text x="360" y="225" font-size="9" fill="#888">Solenoid GND</text>

  <!-- ============================================================ -->
  <!-- CHANNEL 2: SSB (Shift Solenoid B) -->
  <!-- ============================================================ -->

  <text x="560" y="85" font-size="14" font-weight="bold" fill="#1a5276">Channel 2: SSB (Shift Solenoid B)</text>

  <rect x="530" y="110" width="100" height="30" fill="#27ae60" rx="4"/>
  <text x="580" y="130" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Teensy Pin 3</text>

  <line x1="630" y1="125" x2="670" y2="125" stroke="#333" stroke-width="2"/>
  <rect x="670" y="118" width="50" height="14" fill="none" stroke="#333" stroke-width="1.5" rx="2"/>
  <text x="695" y="128" text-anchor="middle" font-size="9" fill="#333" font-weight="bold">100R</text>
  <text x="695" y="110" text-anchor="middle" font-size="9" fill="#555">R3</text>
  <line x1="720" y1="125" x2="760" y2="125" stroke="#333" stroke-width="2"/>
  <circle cx="760" cy="125" r="3" fill="#333"/>

  <line x1="760" y1="125" x2="760" y2="160" stroke="#333" stroke-width="1.5"/>
  <rect x="750" y="160" width="20" height="40" fill="none" stroke="#333" stroke-width="1.5" rx="2"/>
  <text x="775" y="180" font-size="9" fill="#555">R4 100k</text>
  <line x1="760" y1="200" x2="760" y2="220" stroke="#333" stroke-width="1.5"/>
  <line x1="748" y1="220" x2="772" y2="220" stroke="#333" stroke-width="2"/>
  <line x1="752" y1="225" x2="768" y2="225" stroke="#333" stroke-width="1.5"/>
  <line x1="756" y1="230" x2="764" y2="230" stroke="#333" stroke-width="1"/>

  <line x1="760" y1="125" x2="810" y2="125" stroke="#333" stroke-width="2"/>
  <line x1="820" y1="100" x2="820" y2="170" stroke="#333" stroke-width="2"/>
  <line x1="810" y1="125" x2="817" y2="125" stroke="#333" stroke-width="2"/>
  <line x1="820" y1="100" x2="845" y2="100" stroke="#333" stroke-width="2.5"/>
  <line x1="820" y1="170" x2="845" y2="170" stroke="#333" stroke-width="2.5"/>
  <polygon points="820,125 830,120 830,130" fill="#333"/>
  <text x="830" y="145" font-size="10" fill="#333" font-weight="bold">Q2</text>
  <text x="865" y="140" font-size="9" fill="#555">STP36NF06L</text>

  <line x1="845" y1="100" x2="845" y2="60" stroke="#333" stroke-width="2.5"/>
  <circle cx="845" cy="45" r="8" fill="none" stroke="#333" stroke-width="1.5"/>
  <circle cx="845" cy="30" r="8" fill="none" stroke="#333" stroke-width="1.5"/>
  <text x="860" y="40" font-size="10" fill="#333" font-weight="bold">SSB Solenoid</text>
  <line x1="845" y1="22" x2="845" y2="0" stroke="#c0392b" stroke-width="2.5"/>

  <circle cx="790" cy="80" r="3" fill="#333"/>
  <line x1="790" y1="80" x2="790" y2="55" stroke="#333" stroke-width="1.5"/>
  <polygon points="778,55 802,55 790,30" fill="none" stroke="#333" stroke-width="1.5"/>
  <line x1="778" y1="30" x2="802" y2="30" stroke="#333" stroke-width="2"/>
  <line x1="778" y1="30" x2="775" y2="35" stroke="#333" stroke-width="1.5"/>
  <line x1="802" y1="30" x2="805" y2="35" stroke="#333" stroke-width="1.5"/>
  <line x1="790" y1="30" x2="790" y2="10" stroke="#333" stroke-width="1.5"/>
  <line x1="790" y1="10" x2="845" y2="10" stroke="#333" stroke-width="1.5"/>
  <circle cx="845" cy="10" r="3" fill="#333"/>
  <text x="750" y="48" font-size="9" fill="#555" font-weight="bold">TVS2</text>
  <text x="710" y="60" font-size="9" fill="#888">5KP36CA</text>
  <line x1="790" y1="80" x2="845" y2="80" stroke="#333" stroke-width="1.5"/>
  <circle cx="845" cy="80" r="3" fill="#333"/>

  <line x1="845" y1="170" x2="845" y2="220" stroke="#333" stroke-width="2"/>
  <line x1="833" y1="220" x2="857" y2="220" stroke="#333" stroke-width="2.5"/>
  <line x1="837" y1="225" x2="853" y2="225" stroke="#333" stroke-width="2"/>
  <line x1="841" y1="230" x2="849" y2="230" stroke="#333" stroke-width="1.5"/>

  <!-- ============================================================ -->
  <!-- CHANNEL 3: TCC Enable (Torque Converter Clutch On/Off) -->
  <!-- ============================================================ -->

  <text x="60" y="325" font-size="14" font-weight="bold" fill="#1a5276">Channel 3: TCC Enable (On/Off Lockup)</text>

  <rect x="30" y="350" width="100" height="30" fill="#27ae60" rx="4"/>
  <text x="80" y="370" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Teensy Pin 4</text>
  <text x="80" y="392" text-anchor="middle" font-size="9" fill="#888">Digital OUT</text>

  <line x1="130" y1="365" x2="170" y2="365" stroke="#333" stroke-width="2"/>
  <rect x="170" y="358" width="50" height="14" fill="none" stroke="#333" stroke-width="1.5" rx="2"/>
  <text x="195" y="368" text-anchor="middle" font-size="9" fill="#333" font-weight="bold">100R</text>
  <text x="195" y="350" text-anchor="middle" font-size="9" fill="#555">R5</text>
  <line x1="220" y1="365" x2="260" y2="365" stroke="#333" stroke-width="2"/>
  <circle cx="260" cy="365" r="3" fill="#333"/>

  <line x1="260" y1="365" x2="260" y2="400" stroke="#333" stroke-width="1.5"/>
  <rect x="250" y="400" width="20" height="40" fill="none" stroke="#333" stroke-width="1.5" rx="2"/>
  <text x="275" y="420" font-size="9" fill="#555">R6 100k</text>
  <line x1="260" y1="440" x2="260" y2="460" stroke="#333" stroke-width="1.5"/>
  <line x1="248" y1="460" x2="272" y2="460" stroke="#333" stroke-width="2"/>
  <line x1="252" y1="465" x2="268" y2="465" stroke="#333" stroke-width="1.5"/>
  <line x1="256" y1="470" x2="264" y2="470" stroke="#333" stroke-width="1"/>

  <line x1="260" y1="365" x2="310" y2="365" stroke="#333" stroke-width="2"/>
  <line x1="320" y1="340" x2="320" y2="410" stroke="#333" stroke-width="2"/>
  <line x1="310" y1="365" x2="317" y2="365" stroke="#333" stroke-width="2"/>
  <line x1="320" y1="340" x2="345" y2="340" stroke="#333" stroke-width="2.5"/>
  <line x1="320" y1="410" x2="345" y2="410" stroke="#333" stroke-width="2.5"/>
  <polygon points="320,365 330,360 330,370" fill="#333"/>
  <text x="330" y="385" font-size="10" fill="#333" font-weight="bold">Q3</text>
  <text x="365" y="375" font-size="9" fill="#555">STP36NF06L</text>

  <line x1="345" y1="340" x2="345" y2="300" stroke="#333" stroke-width="2.5"/>
  <circle cx="345" cy="285" r="8" fill="none" stroke="#333" stroke-width="1.5"/>
  <circle cx="345" cy="270" r="8" fill="none" stroke="#333" stroke-width="1.5"/>
  <text x="360" y="280" font-size="10" fill="#333" font-weight="bold">TCC Enable Solenoid</text>
  <text x="360" y="293" font-size="9" fill="#888">~1.0A @ 12V</text>
  <line x1="345" y1="262" x2="345" y2="240" stroke="#c0392b" stroke-width="2.5"/>

  <!-- TVS3 -->
  <circle cx="290" cy="320" r="3" fill="#333"/>
  <line x1="290" y1="320" x2="290" y2="295" stroke="#333" stroke-width="1.5"/>
  <polygon points="278,295 302,295 290,270" fill="none" stroke="#333" stroke-width="1.5"/>
  <line x1="278" y1="270" x2="302" y2="270" stroke="#333" stroke-width="2"/>
  <line x1="278" y1="270" x2="275" y2="275" stroke="#333" stroke-width="1.5"/>
  <line x1="302" y1="270" x2="305" y2="275" stroke="#333" stroke-width="1.5"/>
  <line x1="290" y1="270" x2="290" y2="250" stroke="#333" stroke-width="1.5"/>
  <line x1="290" y1="250" x2="345" y2="250" stroke="#333" stroke-width="1.5"/>
  <circle cx="345" cy="250" r="3" fill="#333"/>
  <text x="250" y="288" font-size="9" fill="#555" font-weight="bold">TVS3</text>
  <text x="210" y="300" font-size="9" fill="#888">5KP36CA</text>
  <line x1="290" y1="320" x2="345" y2="320" stroke="#333" stroke-width="1.5"/>
  <circle cx="345" cy="320" r="3" fill="#333"/>

  <line x1="345" y1="410" x2="345" y2="460" stroke="#333" stroke-width="2"/>
  <line x1="333" y1="460" x2="357" y2="460" stroke="#333" stroke-width="2.5"/>
  <line x1="337" y1="465" x2="353" y2="465" stroke="#333" stroke-width="2"/>
  <line x1="341" y1="470" x2="349" y2="470" stroke="#333" stroke-width="1.5"/>

  <!-- ============================================================ -->
  <!-- CHANNEL 4: TCC PWM (Progressive Converter Clutch Apply) -->
  <!-- ============================================================ -->

  <text x="560" y="325" font-size="14" font-weight="bold" fill="#8e44ad">Channel 4: TCC PWM (Progressive Apply)</text>

  <rect x="530" y="350" width="100" height="30" fill="#8e44ad" rx="4"/>
  <text x="580" y="370" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Teensy Pin 12</text>
  <text x="580" y="392" text-anchor="middle" font-size="9" fill="#d2b4de">HW PWM 20-100Hz</text>

  <line x1="630" y1="365" x2="670" y2="365" stroke="#333" stroke-width="2"/>
  <rect x="670" y="358" width="50" height="14" fill="none" stroke="#333" stroke-width="1.5" rx="2"/>
  <text x="695" y="368" text-anchor="middle" font-size="9" fill="#333" font-weight="bold">100R</text>
  <text x="695" y="350" text-anchor="middle" font-size="9" fill="#555">R7</text>
  <line x1="720" y1="365" x2="760" y2="365" stroke="#333" stroke-width="2"/>
  <circle cx="760" cy="365" r="3" fill="#333"/>

  <line x1="760" y1="365" x2="760" y2="400" stroke="#333" stroke-width="1.5"/>
  <rect x="750" y="400" width="20" height="40" fill="none" stroke="#333" stroke-width="1.5" rx="2"/>
  <text x="775" y="420" font-size="9" fill="#555">R8 100k</text>
  <line x1="760" y1="440" x2="760" y2="460" stroke="#333" stroke-width="1.5"/>
  <line x1="748" y1="460" x2="772" y2="460" stroke="#333" stroke-width="2"/>
  <line x1="752" y1="465" x2="768" y2="465" stroke="#333" stroke-width="1.5"/>
  <line x1="756" y1="470" x2="764" y2="470" stroke="#333" stroke-width="1"/>

  <line x1="760" y1="365" x2="810" y2="365" stroke="#333" stroke-width="2"/>
  <line x1="820" y1="340" x2="820" y2="410" stroke="#333" stroke-width="2"/>
  <line x1="810" y1="365" x2="817" y2="365" stroke="#333" stroke-width="2"/>
  <line x1="820" y1="340" x2="845" y2="340" stroke="#333" stroke-width="2.5"/>
  <line x1="820" y1="410" x2="845" y2="410" stroke="#333" stroke-width="2.5"/>
  <polygon points="820,365 830,360 830,370" fill="#333"/>
  <text x="830" y="385" font-size="10" fill="#333" font-weight="bold">Q4</text>
  <text x="865" y="375" font-size="9" fill="#555">STP36NF06L</text>

  <!-- TCC PWM Solenoid -->
  <line x1="845" y1="340" x2="845" y2="300" stroke="#333" stroke-width="2.5"/>
  <circle cx="845" cy="285" r="8" fill="none" stroke="#333" stroke-width="1.5"/>
  <circle cx="845" cy="270" r="8" fill="none" stroke="#333" stroke-width="1.5"/>
  <text x="860" y="280" font-size="10" fill="#8e44ad" font-weight="bold">TCC PWM Solenoid</text>
  <text x="860" y="293" font-size="9" fill="#888">~1.0A @ 12V</text>
  <text x="860" y="305" font-size="9" fill="#888">Progressive apply</text>
  <line x1="845" y1="262" x2="845" y2="240" stroke="#c0392b" stroke-width="2.5"/>

  <!-- DIODE flyback (same as EPC - smooth apply) -->
  <circle cx="790" cy="320" r="3" fill="#333"/>
  <line x1="790" y1="320" x2="790" y2="295" stroke="#333" stroke-width="1.5"/>
  <polygon points="778,295 802,295 790,270" fill="none" stroke="#333" stroke-width="1.5"/>
  <line x1="778" y1="270" x2="802" y2="270" stroke="#333" stroke-width="2.5"/>
  <line x1="790" y1="270" x2="790" y2="250" stroke="#333" stroke-width="1.5"/>
  <line x1="790" y1="250" x2="845" y2="250" stroke="#333" stroke-width="1.5"/>
  <circle cx="845" cy="250" r="3" fill="#333"/>
  <text x="740" y="288" font-size="9" fill="#555" font-weight="bold">D1</text>
  <text x="690" y="300" font-size="9" fill="#8e44ad" font-weight="bold">1N4001 diode</text>
  <text x="690" y="312" font-size="9" fill="#888">(slow decay = smooth</text>
  <text x="690" y="324" font-size="9" fill="#888">progressive apply)</text>
  <line x1="790" y1="320" x2="845" y2="320" stroke="#333" stroke-width="1.5"/>
  <circle cx="845" cy="320" r="3" fill="#333"/>

  <line x1="845" y1="410" x2="845" y2="460" stroke="#333" stroke-width="2"/>
  <line x1="833" y1="460" x2="857" y2="460" stroke="#333" stroke-width="2.5"/>
  <line x1="837" y1="465" x2="853" y2="465" stroke="#333" stroke-width="2"/>
  <line x1="841" y1="470" x2="849" y2="470" stroke="#333" stroke-width="1.5"/>

  <!-- ============================================================ -->
  <!-- CHANNEL 5: EPC (Line Pressure PWM) -->
  <!-- ============================================================ -->

  <text x="60" y="565" font-size="14" font-weight="bold" fill="#e67e22">Channel 5: EPC (Line Pressure PWM) — Critical</text>

  <rect x="30" y="590" width="100" height="30" fill="#e67e22" rx="4"/>
  <text x="80" y="610" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Teensy Pin 5</text>
  <text x="80" y="632" text-anchor="middle" font-size="9" fill="#f0f0f0">HW PWM 200-300Hz</text>

  <line x1="130" y1="605" x2="170" y2="605" stroke="#333" stroke-width="2"/>
  <rect x="170" y="598" width="50" height="14" fill="none" stroke="#333" stroke-width="1.5" rx="2"/>
  <text x="195" y="608" text-anchor="middle" font-size="9" fill="#333" font-weight="bold">100R</text>
  <text x="195" y="590" text-anchor="middle" font-size="9" fill="#555">R9</text>
  <line x1="220" y1="605" x2="260" y2="605" stroke="#333" stroke-width="2"/>
  <circle cx="260" cy="605" r="3" fill="#333"/>

  <line x1="260" y1="605" x2="260" y2="640" stroke="#333" stroke-width="1.5"/>
  <rect x="250" y="640" width="20" height="40" fill="none" stroke="#333" stroke-width="1.5" rx="2"/>
  <text x="275" y="660" font-size="9" fill="#555">R10 100k</text>
  <line x1="260" y1="680" x2="260" y2="700" stroke="#333" stroke-width="1.5"/>
  <line x1="248" y1="700" x2="272" y2="700" stroke="#333" stroke-width="2"/>
  <line x1="252" y1="705" x2="268" y2="705" stroke="#333" stroke-width="1.5"/>
  <line x1="256" y1="710" x2="264" y2="710" stroke="#333" stroke-width="1"/>

  <line x1="260" y1="605" x2="310" y2="605" stroke="#333" stroke-width="2"/>
  <line x1="320" y1="580" x2="320" y2="650" stroke="#333" stroke-width="2"/>
  <line x1="310" y1="605" x2="317" y2="605" stroke="#333" stroke-width="2"/>
  <line x1="320" y1="580" x2="345" y2="580" stroke="#333" stroke-width="2.5"/>
  <line x1="320" y1="650" x2="345" y2="650" stroke="#333" stroke-width="2.5"/>
  <polygon points="320,605 330,600 330,610" fill="#333"/>
  <text x="330" y="625" font-size="10" fill="#333" font-weight="bold">Q5</text>
  <text x="365" y="615" font-size="9" fill="#555">STP36NF06L</text>
  <text x="365" y="628" font-size="9" fill="#e67e22" font-weight="bold">+ HEATSINK</text>

  <!-- EPC Solenoid -->
  <line x1="345" y1="580" x2="345" y2="540" stroke="#333" stroke-width="2.5"/>
  <circle cx="345" cy="525" r="8" fill="none" stroke="#333" stroke-width="1.5"/>
  <circle cx="345" cy="510" r="8" fill="none" stroke="#333" stroke-width="1.5"/>
  <text x="360" y="520" font-size="10" fill="#e67e22" font-weight="bold">EPC Solenoid</text>
  <text x="360" y="533" font-size="9" fill="#888">0-1.1A @ 12V</text>
  <text x="360" y="545" font-size="9" fill="#888">Continuous PWM</text>
  <line x1="345" y1="502" x2="345" y2="480" stroke="#c0392b" stroke-width="2.5"/>

  <!-- DIODE flyback -->
  <circle cx="290" cy="560" r="3" fill="#333"/>
  <line x1="290" y1="560" x2="290" y2="535" stroke="#333" stroke-width="1.5"/>
  <polygon points="278,535 302,535 290,510" fill="none" stroke="#333" stroke-width="1.5"/>
  <line x1="278" y1="510" x2="302" y2="510" stroke="#333" stroke-width="2.5"/>
  <line x1="290" y1="510" x2="290" y2="490" stroke="#333" stroke-width="1.5"/>
  <line x1="290" y1="490" x2="345" y2="490" stroke="#333" stroke-width="1.5"/>
  <circle cx="345" cy="490" r="3" fill="#333"/>
  <text x="250" y="528" font-size="9" fill="#555" font-weight="bold">D2</text>
  <text x="190" y="540" font-size="9" fill="#e67e22" font-weight="bold">1N4001 diode</text>
  <text x="190" y="552" font-size="9" fill="#888">(slow decay = smooth</text>
  <text x="190" y="564" font-size="9" fill="#888">pressure modulation)</text>
  <line x1="290" y1="560" x2="345" y2="560" stroke="#333" stroke-width="1.5"/>
  <circle cx="345" cy="560" r="3" fill="#333"/>

  <line x1="345" y1="650" x2="345" y2="700" stroke="#333" stroke-width="2"/>
  <line x1="333" y1="700" x2="357" y2="700" stroke="#333" stroke-width="2.5"/>
  <line x1="337" y1="705" x2="353" y2="705" stroke="#333" stroke-width="2"/>
  <line x1="341" y1="710" x2="349" y2="710" stroke="#333" stroke-width="1.5"/>

  <!-- ============================================================ -->
  <!-- SHARED +12V RAIL AND BULK CAP -->
  <!-- ============================================================ -->

  <text x="1050" y="85" font-size="14" font-weight="bold" fill="#c0392b">Shared Solenoid Power</text>

  <rect x="1050" y="110" width="130" height="35" fill="#e74c3c" rx="4"/>
  <text x="1115" y="132" text-anchor="middle" font-size="11" fill="white" font-weight="bold">+12V_SOLENOID</text>
  <text x="1115" y="150" text-anchor="middle" font-size="9" fill="#f0f0f0">From protected rail</text>

  <line x1="1115" y1="145" x2="1115" y2="180" stroke="#333" stroke-width="2"/>
  <circle cx="1115" cy="165" r="3" fill="#333"/>
  <line x1="1105" y1="180" x2="1125" y2="180" stroke="#333" stroke-width="2.5"/>
  <line x1="1105" y1="186" x2="1125" y2="186" stroke="#333" stroke-width="2.5"/>
  <line x1="1115" y1="186" x2="1115" y2="210" stroke="#333" stroke-width="2"/>
  <line x1="1103" y1="210" x2="1127" y2="210" stroke="#333" stroke-width="2.5"/>
  <line x1="1107" y1="215" x2="1123" y2="215" stroke="#333" stroke-width="2"/>
  <line x1="1111" y1="220" x2="1119" y2="220" stroke="#333" stroke-width="1.5"/>
  <text x="1135" y="195" font-size="9" fill="#555">C_BULK</text>
  <text x="1135" y="207" font-size="9" fill="#888">470-1000uF</text>
  <text x="1135" y="219" font-size="9" fill="#888">35V low-ESR</text>

  <rect x="1050" y="240" width="310" height="75" fill="#fef5e7" rx="4" stroke="#e67e22" stroke-width="1.5"/>
  <text x="1205" y="260" text-anchor="middle" font-size="11" fill="#e67e22" font-weight="bold">Local Decoupling</text>
  <text x="1065" y="280" font-size="9" fill="#666">Each channel needs 0.1uF ceramic cap</text>
  <text x="1065" y="295" font-size="9" fill="#666">between +12V and GND, placed close to</text>
  <text x="1065" y="310" font-size="9" fill="#666">MOSFET drain connection.</text>

  <!-- ============================================================ -->
  <!-- KEY DIFFERENCES TABLE -->
  <!-- ============================================================ -->

  <text x="60" y="770" font-size="14" font-weight="bold" fill="#1a5276">Key Design Differences</text>

  <rect x="60" y="790" width="900" height="25" fill="#2c3e50" rx="3"/>
  <text x="80" y="807" font-size="10" fill="white" font-weight="bold">Channel</text>
  <text x="220" y="807" font-size="10" fill="white" font-weight="bold">Solenoid Type</text>
  <text x="380" y="807" font-size="10" fill="white" font-weight="bold">Flyback Protection</text>
  <text x="600" y="807" font-size="10" fill="white" font-weight="bold">Why Different?</text>

  <rect x="60" y="815" width="900" height="30" fill="#f8f9fa"/>
  <text x="80" y="832" font-size="10" fill="#333">SSA / SSB</text>
  <text x="220" y="832" font-size="10" fill="#333">On/Off shift control</text>
  <text x="380" y="832" font-size="10" fill="#27ae60" font-weight="bold">5KP36CA TVS</text>
  <text x="600" y="832" font-size="9" fill="#666">Fast current decay = crisp shifts</text>

  <rect x="60" y="845" width="900" height="30" fill="#fff"/>
  <text x="80" y="862" font-size="10" fill="#333">TCC Enable</text>
  <text x="220" y="862" font-size="10" fill="#333">On/Off clutch lockup</text>
  <text x="380" y="862" font-size="10" fill="#27ae60" font-weight="bold">5KP36CA TVS</text>
  <text x="600" y="862" font-size="9" fill="#666">Crisp engagement/disengagement</text>

  <rect x="60" y="875" width="900" height="30" fill="#f5eef8"/>
  <text x="80" y="892" font-size="10" fill="#8e44ad" font-weight="bold">TCC PWM</text>
  <text x="220" y="892" font-size="10" fill="#8e44ad">Progressive clutch apply</text>
  <text x="380" y="892" font-size="10" fill="#8e44ad" font-weight="bold">1N4001 Diode</text>
  <text x="600" y="892" font-size="9" fill="#8e44ad">Slow decay = smooth progressive lockup</text>

  <rect x="60" y="905" width="900" height="30" fill="#fef5e7"/>
  <text x="80" y="922" font-size="10" fill="#e67e22" font-weight="bold">EPC</text>
  <text x="220" y="922" font-size="10" fill="#e67e22">PWM pressure control</text>
  <text x="380" y="922" font-size="10" fill="#e67e22" font-weight="bold">1N4001 Diode</text>
  <text x="600" y="922" font-size="9" fill="#e67e22">Slow decay acts as LP filter = smooth pressure</text>

  <rect x="60" y="790" width="900" height="147" fill="none" stroke="#ccc" stroke-width="1" rx="3"/>

  <!-- ============================================================ -->
  <!-- FAILSAFE BEHAVIOR -->
  <!-- ============================================================ -->

  <text x="60" y="970" font-size="14" font-weight="bold" fill="#1a5276">Fail-Safe Behavior (Hardware + Firmware)</text>

  <rect x="60" y="990" width="900" height="135" fill="#fdf2f2" rx="4" stroke="#e74c3c" stroke-width="1.5"/>
  <text x="80" y="1010" font-size="11" fill="#c0392b" font-weight="bold">On MCU Reset / Power Loss:</text>
  <text x="100" y="1030" font-size="10" fill="#666">* Gate pulldowns (100k) force all MOSFETs OFF</text>
  <text x="100" y="1048" font-size="10" fill="#666">* SSA OFF + SSB OFF = 3rd gear (intentional GM limp mode)</text>
  <text x="100" y="1066" font-size="10" fill="#666">* EPC 0% duty = MAX line pressure (project failsafe assumption)</text>
  <text x="100" y="1084" font-size="10" fill="#666">* TCC Enable OFF = torque converter unlocked (prevents stall)</text>
  <text x="100" y="1102" font-size="10" fill="#666">* TCC PWM 0% duty = no progressive apply (converter stays unlocked)</text>
  <text x="100" y="1120" font-size="10" fill="#888" font-style="italic">Design philosophy: Harsh operation is acceptable. Clutch slip is NOT.</text>

  <!-- ============================================================ -->
  <!-- COMPONENT SUMMARY -->
  <!-- ============================================================ -->

  <rect x="1050" y="340" width="310" height="370" fill="#f9f9f9" rx="5" stroke="#ccc" stroke-width="1"/>
  <text x="1205" y="362" text-anchor="middle" font-size="12" font-weight="bold" fill="#333">BOM Per Channel</text>

  <text x="1070" y="385" font-size="10" fill="#333"><tspan font-weight="bold">Q1-Q5:</tspan> STP36NF06L (TO-220)</text>
  <text x="1070" y="402" font-size="10" fill="#333"><tspan font-weight="bold">R (gate):</tspan> 100R, 1/4W (x5)</text>
  <text x="1070" y="419" font-size="10" fill="#333"><tspan font-weight="bold">R (pulldown):</tspan> 100k, 1/4W (x5)</text>
  <text x="1070" y="436" font-size="10" fill="#333"><tspan font-weight="bold">TVS1-3:</tspan> 5KP36CA (axial) (x3)</text>
  <text x="1070" y="453" font-size="10" fill="#333"><tspan font-weight="bold">D1:</tspan> 1N4001 (TCC PWM)</text>
  <text x="1070" y="470" font-size="10" fill="#333"><tspan font-weight="bold">D2:</tspan> 1N4001 (EPC)</text>
  <text x="1070" y="487" font-size="10" fill="#333"><tspan font-weight="bold">C (local):</tspan> 0.1uF ceramic (x5)</text>
  <text x="1070" y="504" font-size="10" fill="#333"><tspan font-weight="bold">C_BULK:</tspan> 470-1000uF / 35V (shared)</text>

  <line x1="1070" y1="517" x2="1340" y2="517" stroke="#ddd" stroke-width="1"/>

  <text x="1070" y="537" font-size="10" fill="#1a5276" font-weight="bold">Critical Notes:</text>
  <text x="1070" y="554" font-size="9" fill="#555">* EPC MOSFET needs heatsink (continuous PWM)</text>
  <text x="1070" y="569" font-size="9" fill="#555">* All solenoids share +12V rail (with fusing)</text>
  <text x="1070" y="584" font-size="9" fill="#555">* Star ground — solenoid returns separate</text>
  <text x="1070" y="599" font-size="9" fill="#555">  from signal ground until star point</text>
  <text x="1070" y="614" font-size="9" fill="#555">* Never drive solenoids directly from MCU</text>
  <text x="1070" y="629" font-size="9" fill="#555">* EPC PWM: 200-300Hz (hardware PWM)</text>
  <text x="1070" y="644" font-size="9" fill="#555">* TCC PWM: 20-100Hz (hardware PWM)</text>
  <text x="1070" y="659" font-size="9" fill="#555">* 0% EPC duty = MAX pressure (failsafe)</text>
  <text x="1070" y="674" font-size="9" fill="#555">* 60% EPC duty = hard ceiling (~1.1A limit)</text>

  <line x1="1070" y1="687" x2="1340" y2="687" stroke="#ddd" stroke-width="1"/>

  <text x="1070" y="702" font-size="9" fill="#888" font-style="italic">Design validated against MegaShift</text>
  <text x="1070" y="715" font-size="9" fill="#888" font-style="italic">and GM service manuals.</text>

  <!-- Signal flow note -->
  <text x="60" y="1160" font-size="10" fill="#888">Signal flow: Teensy GPIO (3.3V) > Gate resistor (100R) > MOSFET gate > Drain switches solenoid to GND > Flyback protection clamps inductive spike</text>
  <text x="60" y="1180" font-size="10" fill="#888">Protection: All gates have 100k pulldowns (OFF at reset) | TVS/diode flyback prevents voltage spikes | Bulk + local decoupling for clean switching</text>

</svg>
